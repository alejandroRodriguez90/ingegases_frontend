<div class="inventario-module">
    <!-- Pantalla principal con tarjetas -->
    <div id="mainScreen" class="main-screen">
        <div class="main-header">
            <h1 class="main-title">
                <div class="title-icon-container">
                    <div class="title-icon">üì¶</div>
                </div>
                Control de Inventario
            </h1>
            <p class="main-subtitle">Gesti√≥n de inventario para Ingegases y Redes s.a.s.</p>
            
            <div class="card-container">
                <div class="inventario-card" onclick="navigateToTuberia()">
                    <div class="card-icon-container">
                        <div class="card-icon">üõ†Ô∏è</div>
                    </div>
                    <h3>Tuber√≠a</h3>
                    <p class="card-description">Inventario de Tuberia y control detallado.</p>
                </div>
                
                <div class="inventario-card" onclick="navigateToAccesorios()">
                    <div class="card-icon-container">
                        <div class="card-icon">üî©</div>
                    </div>
                    <h3>Accesorios</h3>
                    <p class="card-description">Inventario de accesorios y control detallado.</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Submen√∫ interno (oculto inicialmente) -->
    <div id="detailScreen" style="display: none;">
        <div class="submenu-inventario">
            <!-- Mantener estos botones pero ocultos visualmente -->
            <button id="tuberiaTab" class="active" style="position: absolute; left: -9999px;" onclick="navigateToTuberia(); return false;">Tuber√≠a</button>
            <button id="accesoriosTab" style="position: absolute; left: -9999px;" onclick="navigateToAccesorios(); return false;">Accesorios</button>
            
            <!-- Bot√≥n de volver visible -->
            <button class="back-button" onclick="backToMain()">
                <i class="fas fa-arrow-left"></i> Volver
            </button>
        </div>
        
        <div id="inventarioContent" class="content-transition"></div>
    </div>

    <style>
       :root {
    --primary-color: #4361ee;
    --primary-hover: #3a56d4;
    --secondary-color: #3f37c9;
    --accent-blue: #4cc9f0;
    --accent-orange: #f8961e;
    --text-dark: #2b2d42;
    --text-medium: #4a4e69;
    --text-light: #8e9aaf;
    --background-light: #f8f9fa;
    --white: #ffffff;
    --transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 4px 8px rgba(0, 0, 0, 0.12);
    --shadow-lg: 0 10px 20px rgba(0, 0, 0, 0.15);
    --border-radius: 16px;
}



/* ============ PANTALLA PRINCIPAL ============= */

.main-screen {
    width: 100%;
    padding: 40px 40px;
    background-color: var(--background-light);
    text-align: center;
    box-sizing: border-box;
    font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    /* Elimina position: fixed y height: 100vh */
    /* Agrega min-height para asegurar que ocupe al menos toda la pantalla */
    min-height: calc(100vh - 60px); /* Ajusta seg√∫n la altura de tu top-bar */
    overflow-y: auto; /* Permite el desplazamiento vertical */
}

.main-header {
    max-width: 1200px;
    margin: 0 auto 20px;
    padding-top: 40px; /* Reduce el padding-top */
}

.main-title {
    font-size: 2.8rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 24px;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 20px;
}

.main-title i {
    font-size: 2.5rem;
    color: var(--primary-color);
    background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
    -webkit-text-fill-color: transparent;
}

.main-subtitle {
    color: var(--text-light);
    font-size: 1.3rem;
    font-weight: 400;
    margin-bottom: 60px;
    max-width: 700px;
    margin-left: auto;
    margin-right: auto;
    line-height: 1.6;
}

.card-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 20px;
    max-width: 1200px;
    margin: 0 auto;
    padding-bottom: 40px; /* A√±ade espacio en la parte inferior */
}

.inventario-card {
    background: var(--white);
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    padding: 30px 20px; /* Reducido padding */
    cursor: pointer;
    transition: var(--transition);
    position: relative;
    overflow: hidden;
    border: 1px solid rgba(0, 0, 0, 0.05);
}

.inventario-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 5px;
    background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
    transform: scaleX(0);
    transform-origin: left;
    transition: transform 0.7s ease;
}

.inventario-card:hover {
    transform: translateY(-10px);
    box-shadow: var(--shadow-lg);
}

.inventario-card:hover::before {
    transform: scaleX(1);
}

.card-icon-container {
    width: 100px;
    height: 100px;
    margin: 0 auto 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: linear-gradient(135deg, rgba(67, 97, 238, 0.1), rgba(63, 55, 201, 0.1));
    border-radius: 50%;
    transition: var(--transition);
}

.inventario-card:hover .card-icon-container {
    transform: scale(1.1) rotate(5deg);
}

.card-icon {
    font-size: 3.5rem;
    line-height: 1;
    transition: transform 0.3s ease;
}

.inventario-card:hover .card-icon {
    transform: scale(1.2);
}

.inventario-card h3 {
    font-size: 1.6rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 15px;
}

.card-description {
    color: var(--text-light);
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: 20px;
    opacity: 1;
    height: auto;
}

/* ============ RESPONSIVE IMPROVEMENTS ============= */
@media (max-width: 1200px) {
    .card-container {
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }
}

@media (max-width: 992px) {
    .inventario-card {
        min-height: 260px;
        padding: 25px;
    }
    .card-icon-container {
        width: 90px;
        height: 90px;
    }
}

@media (max-width: 768px) {
    .card-container {
        grid-template-columns: 1fr;
        max-width: 500px;
        padding: 0 15px;
    }
    .inventario-card {
        min-height: 240px;
        padding: 30px 20px;
        max-width: 100%;
    }
    .card-icon {
        font-size: 3rem;
    }
}

@media (max-width: 576px) {
    .card-container {
        gap: 20px;
    }
    .inventario-card {
        min-height: 220px;
        padding: 25px 15px;
    }
    .card-icon-container {
        width: 80px;
        height: 80px;
        margin-bottom: 20px;
    }
    .inventario-card h3 {
        font-size: 1.5rem;
    }
}

@media (max-width: 400px) {
    .card-container {
        padding: 0 10px;
    }
    .inventario-card {
        min-height: 200px;
        padding: 20px 15px;
    }
    .card-icon {
        font-size: 2.8rem;
    }
}

        /* ============================================= */
        /* ============ ESTILOS EXISTENTES ============= */
        /* ============================================= */
        /* (Manteniendo todos tus estilos existentes) */
       
        
        .inventario-module {
            width: 100%;
            height: 100%;
            padding: 0 !important; /* Eliminar padding */
            box-sizing: border-box;
        }

        /* Pantalla de detalle (tuber√≠a/accesorios) */
        #detailScreen {
            width: 100%;
            min-height: calc(100vh - 60px); /* Ajusta seg√∫n altura del top-bar */
            padding: 0 !important; /* Eliminar padding */
            box-sizing: border-box;
            overflow-y: auto; /* Permite desplazamiento */
            display: none; /* Mantenemos oculto inicialmente */
        }
        /* Contenedor del contenido */
        #inventarioContent {
            width: 100%;
            min-height: calc(100vh - 120px); /* Ajusta seg√∫n necesidades */
            padding: 0 !important; /* Eliminar padding */
            box-sizing: border-box;
        }

        .submenu-inventario {
            display: flex;
            margin: 15px 0;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }

        .submenu-inventario button {
            padding: 8px 16px;
            margin-right: 10px;
            background-color: #ecf0f1;
            border: none;
            border-radius: 4px;
            color: #34495e;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .submenu-inventario button:hover, 
        .submenu-inventario button.active {
            background-color: #3498db;
            color: white;
        }

        /* Contenedor principal para t√≠tulo y tabla */
        .table-title-container {
            display: flex;
            align-items: center;
            width: 100%;
            min-height: 60px;
        }

        .section-title.vertical-title {
            writing-mode: vertical-rl; /* Texto vertical */
            transform: rotate(180deg); /* Rotaci√≥n 180¬∞ */
            text-align: center; /* Centrado */
            padding: 80px 10px; /* Espaciado */
            background-color: #f4fb32c6; /* Fondo amarillo */
            color: rgb(68, 61, 61); /* Color texto */
            font-weight: bold; /* Negrita */
            display: inline-block; /* Display inline-block */
            vertical-align: top; /* Alineaci√≥n superior */
            margin-right: 5px; /* Margen derecho */
        }

        /* Tablas */
        .table-container {
            display: inline-flex;
            flex-direction: column;
            width: calc(100% - 50px); /* Margen izquierdo impl√≠cito de 100px */
            background: white;
            border-radius: 5px; /* Ajustar bordes */
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            max-height: 60vh;
            margin-left: 0; /* Eliminar margen izquierdo */
            overflow-y: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th, td {
            padding: 15px 15px; /* Padding izquierdo y derecho de 15px */
            text-align: left;
            border-bottom: 1px solid #e0e0e0;
        }

        th {
            background-color: #34495e;
            color: white;
            font-weight: 500;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        input[type="text"], 
        input[type="number"],
        select {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 14px;
        }

        input[type="text"]:focus, 
        input[type="number"]:focus,
        select:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 2px rgba(52,152,219,0.2);
        }

        #inputUbicacion, #inputUbicacionAccesorio {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 8px center;
            background-size: 14px;
            padding-right: 25px;
        }

        .no-stock {
            color: #e74c3c;
            font-weight: bold;
            padding: 8px 12px;
            display: inline-block;
            background-color: #fde8e8;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .no-stock:hover {
            background-color: #fad2d2;
            transform: scale(1.05);
        }
        

        .export-button-container {
            padding: 15px;
            text-align: right;
        }

        #btnExportar, #btnExportarAccesorios {
            background-color: #2ecc71;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s ease;
        }

        #btnExportar:hover, #btnExportarAccesorios:hover {
            background-color: #27ae60;
        }

        /* CONTENEDORES DE GR√ÅFICAS - IGUALES PARA AMBOS */
        .chart-container {
            margin-top: 20px;
            padding: 50px; /* Espaciado interno */
            background-color: #ffffff;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            width: calc(100% - 130px); /* Margen izquierdo impl√≠cito de 100px */
            height: 300px;
            display: block !important;
            margin-left: 10px; /* Centrado */
            margin-right: auto; /* Centrado */
        }

        #tuberiaChart, #accesoriosChart {
            width: 100% !important;
            height: calc(100% - 40px) !important;
            min-height: 250px;
            display: block !important;
        }

        .chart-container h3 {
            margin-top: 0;
            margin-bottom: 15px;
            color: #34495e;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
            font-size: 1.2rem;
        }

        .table-title-container {
            margin-bottom: 20px;
        }

        /* AJUSTES ESPEC√çFICOS PARA ACCESORIOS */
        /* Para mantener consistencia con tuber√≠a */
        #listaAccesorios {
            width: 100%;
        }

        #inputDescripcionAccesorio {
            width: 100%;
        }

        #cantidadCellAccesorio {
            width: 120px;
        }
        

        .back-button {
            background: #c1defa !important;  /* Color azul */
            color: rgb(0, 0, 0) !important;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-left: auto; /* Alinea a la derecha */
            display: block;
        }

        .back-button:hover {
            background: #7cc1fa !important;  /* Azul m√°s oscuro */
            transform: translateY(-2px);
        }

        /* RESPONSIVE - IGUAL PARA AMBOS */
        @media (max-width: 768px) {
            .table-title-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .section-title.vertical-title {
                writing-mode: horizontal-tb;
                transform: none;
                padding: 15px;
                width: 100%;
                height: auto;
                min-height: auto;
                border-radius: 12px 12px 0 0;
                margin-right: 0px;
                display: block;
            }
            
            .table-container {
                width: 100%;
                border-radius: 0 0 12px 12px;
            }
            
            .chart-container {
                width: 100%;
                height: 250px;
            }
            
            #tuberiaChart, #accesoriosChart {
                min-height: 200px;
            }
            
            .main-title {
                font-size: 1.8rem;
            }
            
            .main-subtitle {
                font-size: 0.95rem;
            }
            
            .card-container {
                flex-direction: column;
                align-items: center;
            }
            
            .inventario-card {
                width: 100%;
                max-width: 350px;
            }
        }
        @media (max-width: 768px) {
            .section-title.vertical-title {
                background-color: #f8f8f8; /* Fondo m√°s claro para m√≥viles */
                color: var(--text-dark); /* Texto m√°s oscuro */
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Se agregaron ajustes espec√≠ficos para m√≥viles: */
        @media (max-width: 576px) {
            .inventario-card {
                min-height: 220px;
                padding: 25px 15px;
            }
            /* ... */
        }
    </style>


    <script>
// ==========================================================================
// FUNCIONES DE NAVEGACI√ìN (ACTUALIZADAS)
// ==========================================================================
function backToMain() {
    document.getElementById('mainScreen').style.display = 'block';
    document.getElementById('detailScreen').style.display = 'none';
    // Ajustar el scroll al inicio
    window.scrollTo(0, 0);
}

function showDetailScreen() {
    document.getElementById('mainScreen').style.display = 'none';
    document.getElementById('detailScreen').style.display = 'block';
    // Ajustar el scroll al inicio
    window.scrollTo(0, 0);
    // Forzar redibujado para asegurar dimensiones correctas
    setTimeout(() => {
        if (chart) chart.resize();
        if (chartAccesorios) chartAccesorios.resize();
    }, 100);
}

function navigateToTuberia() {
    showDetailScreen();
    document.getElementById('tuberiaTab').classList.add('active');
    document.getElementById('accesoriosTab').classList.remove('active');
    loadTuberia();
}

function navigateToAccesorios() {
    showDetailScreen();
    document.getElementById('accesoriosTab').classList.add('active');
    document.getElementById('tuberiaTab').classList.remove('active');
    loadAccesorios();
}



    // ==========================================================================
    // INVENTARIO TUBERIA 
    // ==========================================================================
    const tuberiasDisponibles = [
    // Tuber√≠as de Cobre
    {codigo: "IYR0001", descripcion: "Tuber√≠aCobre K 1/4"},
    {codigo: "IYR0002", descripcion: "Tuber√≠aCobre K 3/8"},
    {codigo: "IYR0003", descripcion: "Tuber√≠aCobre K 1/2"},
    {codigo: "IYR0004", descripcion: "Tuber√≠aCobre K 3/4"},
    {codigo: "IYR0005", descripcion: "Tuber√≠aCobre K 1"},
    {codigo: "IYR0006", descripcion: "Tuber√≠aCobre K 1.1/4"},
    {codigo: "IYR0007", descripcion: "Tuber√≠aCobre K 1.1/2"},
    {codigo: "IYR0008", descripcion: "Tuber√≠aCobre K 2"},
    {codigo: "IYR0009", descripcion: "Tuber√≠aCobre K 2.1/2"},
    {codigo: "IYR0010", descripcion: "Tuber√≠aCobre K 3"},
    {codigo: "IYR0011", descripcion: "Tuber√≠aCobre L 1/4"},
    {codigo: "IYR0012", descripcion: "Tuber√≠aCobre L 3/8"},
    {codigo: "IYR0013", descripcion: "Tuber√≠aCobre L 1/2"},
    {codigo: "IYR0014", descripcion: "Tuber√≠aCobre L 3/4"},
    {codigo: "IYR0015", descripcion: "Tuber√≠aCobre L 1"},
    {codigo: "IYR0016", descripcion: "Tuber√≠aCobre L 1.1/4"},
    {codigo: "IYR0017", descripcion: "Tuber√≠aCobre L 1.1/2"},
    {codigo: "IYR0018", descripcion: "Tuber√≠aCobre L 2"},
    {codigo: "IYR0019", descripcion: "Tuber√≠aCobre L 2.1/2"},
    {codigo: "IYR0020", descripcion: "Tuber√≠aCobre L 3"},
    
    // Tuber√≠as de Acero Inoxidable
    {codigo: "IYR0021", descripcion: "Tuber√≠aAceroInoxidable Sch10 1/4"},
    {codigo: "IYR0022", descripcion: "Tuber√≠aAceroInoxidable Sch10 3/8"},
    {codigo: "IYR0023", descripcion: "Tuber√≠aAceroInoxidable Sch10 1/2"},
    {codigo: "IYR0024", descripcion: "Tuber√≠aAceroInoxidable Sch10 3/4"},
    {codigo: "IYR0025", descripcion: "Tuber√≠aAceroInoxidable Sch10 1"},
    {codigo: "IYR0026", descripcion: "Tuber√≠aAceroInoxidable Sch10 1.1/4"},
    {codigo: "IYR0027", descripcion: "Tuber√≠aAceroInoxidable Sch10 1.1/2"},
    {codigo: "IYR0028", descripcion: "Tuber√≠aAceroInoxidable Sch10 2"},
    {codigo: "IYR0029", descripcion: "Tuber√≠aAceroInoxidable Sch10 2.1/2"},
    {codigo: "IYR0030", descripcion: "Tuber√≠aAceroInoxidable Sch10 3"},
    {codigo: "IYR0031", descripcion: "Tuber√≠aAceroInoxidable Sch40 1/4"},
    {codigo: "IYR0032", descripcion: "Tuber√≠aAceroInoxidable Sch40 3/8"},
    {codigo: "IYR0033", descripcion: "Tuber√≠aAceroInoxidable Sch40 1/2"},
    {codigo: "IYR0034", descripcion: "Tuber√≠aAceroInoxidable Sch40 3/4"},
    {codigo: "IYR0035", descripcion: "Tuber√≠aAceroInoxidable Sch40 1"},
    {codigo: "IYR0036", descripcion: "Tuber√≠aAceroInoxidable Sch40 1.1/4"},
    {codigo: "IYR0037", descripcion: "Tuber√≠aAceroInoxidable Sch40 1.1/2"},
    {codigo: "IYR0038", descripcion: "Tuber√≠aAceroInoxidable Sch40 2"},
    {codigo: "IYR0039", descripcion: "Tuber√≠aAceroInoxidable Sch40 2.1/2"},
    {codigo: "IYR0040", descripcion: "Tuber√≠aAceroInoxidable Sch40 3"},
    {codigo: "IYR0041", descripcion: "Tuber√≠aAceroInoxidable Sch80 1/4"},
    {codigo: "IYR0042", descripcion: "Tuber√≠aAceroInoxidable Sch80 3/8"},
    {codigo: "IYR0043", descripcion: "Tuber√≠aAceroInoxidable Sch80 1/2"},
    {codigo: "IYR0044", descripcion: "Tuber√≠aAceroInoxidable Sch80 3/4"},
    {codigo: "IYR0045", descripcion: "Tuber√≠aAceroInoxidable Sch80 1"},
    {codigo: "IYR0046", descripcion: "Tuber√≠aAceroInoxidable Sch80 1.1/4"},
    {codigo: "IYR0047", descripcion: "Tuber√≠aAceroInoxidable Sch80 1.1/2"},
    {codigo: "IYR0048", descripcion: "Tuber√≠aAceroInoxidable Sch80 2"},
    {codigo: "IYR0049", descripcion: "Tuber√≠aAceroInoxidable Sch80 2.1/2"},
    {codigo: "IYR0050", descripcion: "Tuber√≠aAceroInoxidable Sch80 3"},
    
    // Tuber√≠as de Acero Carbono
    {codigo: "IYR0051", descripcion: "Tuber√≠aAceroCarbono Sch10 1/4"},
    {codigo: "IYR0052", descripcion: "Tuber√≠aAceroCarbono Sch10 3/8"},
    {codigo: "IYR0053", descripcion: "Tuber√≠aAceroCarbono Sch10 1/2"},
    {codigo: "IYR0054", descripcion: "Tuber√≠aAceroCarbono Sch10 3/4"},
    {codigo: "IYR0055", descripcion: "Tuber√≠aAceroCarbono Sch10 1"},
    {codigo: "IYR0056", descripcion: "Tuber√≠aAceroCarbono Sch10 1.1/4"},
    {codigo: "IYR0057", descripcion: "Tuber√≠aAceroCarbono Sch10 1.1/2"},
    {codigo: "IYR0058", descripcion: "Tuber√≠aAceroCarbono Sch10 2"},
    {codigo: "IYR0059", descripcion: "Tuber√≠aAceroCarbono Sch10 2.1/2"},
    {codigo: "IYR0060", descripcion: "Tuber√≠aAceroCarbono Sch10 3"},
    {codigo: "IYR0061", descripcion: "Tuber√≠aAceroCarbono Sch40 1/4"},
    {codigo: "IYR0062", descripcion: "Tuber√≠aAceroCarbono Sch40 3/8"},
    {codigo: "IYR0063", descripcion: "Tuber√≠aAceroCarbono Sch40 1/2"},
    {codigo: "IYR0064", descripcion: "Tuber√≠aAceroCarbono Sch40 3/4"},
    {codigo: "IYR0065", descripcion: "Tuber√≠aAceroCarbono Sch40 1"},
    {codigo: "IYR0066", descripcion: "Tuber√≠aAceroCarbono Sch40 1.1/4"},
    {codigo: "IYR0067", descripcion: "Tuber√≠aAceroCarbono Sch40 1.1/2"},
    {codigo: "IYR0068", descripcion: "Tuber√≠aAceroCarbono Sch40 2"},
    {codigo: "IYR0069", descripcion: "Tuber√≠aAceroCarbono Sch40 2.1/2"},
    {codigo: "IYR0070", descripcion: "Tuber√≠aAceroCarbono Sch40 3"},
    {codigo: "IYR0071", descripcion: "Tuber√≠aAceroCarbono Sch80 1/4"},
    {codigo: "IYR0072", descripcion: "Tuber√≠aAceroCarbono Sch80 3/8"},
    {codigo: "IYR0073", descripcion: "Tuber√≠aAceroCarbono Sch80 1/2"},
    {codigo: "IYR0074", descripcion: "Tuber√≠aAceroCarbono Sch80 3/4"},
    {codigo: "IYR0075", descripcion: "Tuber√≠aAceroCarbono Sch80 1"},
    {codigo: "IYR0076", descripcion: "Tuber√≠aAceroCarbono Sch80 1.1/4"},
    {codigo: "IYR0077", descripcion: "Tuber√≠aAceroCarbono Sch80 1.1/2"},
    {codigo: "IYR0078", descripcion: "Tuber√≠aAceroCarbono Sch80 2"},
    {codigo: "IYR0079", descripcion: "Tuber√≠aAceroCarbono Sch80 2.1/2"},
    {codigo: "IYR0080", descripcion: "Tuber√≠aAceroCarbono Sch80 3"},
    
    // Tuber√≠as de PVC
    {codigo: "IYR0081", descripcion: "Tuber√≠aPVCPresion 3/8"},
    {codigo: "IYR0082", descripcion: "Tuber√≠aPVCPresion 1/2"},
    {codigo: "IYR0083", descripcion: "Tuber√≠aPVCPresion 3/4"},
    {codigo: "IYR0084", descripcion: "Tuber√≠aPVCPresion 1"},
    {codigo: "IYR0085", descripcion: "Tuber√≠aPVCPresion 1.1/4"},
    {codigo: "IYR0086", descripcion: "Tuber√≠aPVCPresion 1.1/2"},
    {codigo: "IYR0087", descripcion: "Tuber√≠aPVCPresion 2"},
    {codigo: "IYR0088", descripcion: "Tuber√≠aPVCPresion 2.1/2"},
    {codigo: "IYR0089", descripcion: "Tuber√≠aPVCPresion 3"},
    
    // Tuber√≠as EMT
    {codigo: "IYR0090", descripcion: "Tuber√≠aEMT 1/2"},
    {codigo: "IYR0091", descripcion: "Tuber√≠aEMT 3/4"},
    {codigo: "IYR0092", descripcion: "Tuber√≠aEMT 1"},
    {codigo: "IYR0093", descripcion: "Tuber√≠aEMT 1.1/2"},
    {codigo: "IYR0094", descripcion: "Tuber√≠aEMT 2"}
];
// Crear mapeo de descripciones a c√≥digos
const descripcionToCodigo = {};
tuberiasDisponibles.forEach(item => {
    descripcionToCodigo[item.descripcion] = item.codigo;
});

// Variables globales
let itemActual = null;
let chart = null;
const ubicacionesDisponibles = ["Bogot√°", "Cali"];


// ==========================================================================
// INVENTARIO TUBERIA - FUNCIONES AUXILIARES
// ==========================================================================
function generarFilasTuberia(productos) {
    return productos.map(producto => `
        <tr>
            <td>${producto.codigo}</td>
            <td>${producto.descripcion}</td>
            <td>${producto.ubicacion || 'N/A'}</td>
            <td>${producto.cantidad}</td>
            <td>${producto.valor ? '$' + producto.valor.toFixed(2) : 'N/A'}</td>
        </tr>
    `).join('');
}


// ==========================================================================
// FUNCI√ìN PRINCIPAL PARA CARGAR TUBER√çA
// ==========================================================================


function loadTuberia() {
    
    // Obtener productos de tuber√≠a del m√≥dulo compartido
    const productosTuberia = InventarioCompartido.obtenerProductos()
        .filter(p => p.descripcion.includes('Tuber√≠a'));

    const tableContent = `
        <div class="table-title-container">
            <div class="section-title vertical-title">Tuber√≠a</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descripci√≥n</th>
                            <th>Ubicaci√≥n</th>
                            <th>Cantidad</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${generarFilaConsulta()}
                    </tbody>
                </table>
                <div class="export-button-container">
                    <button id="btnExportar" class="btn-export">Exportar a Excel</button>
                </div>
            </div>
        </div>
        <div class="chart-container" style="display: none;">
            <h3>Gr√°fica de Consulta</h3>
            <canvas id="tuberiaChart"></canvas>
        </div>
    `;

    document.getElementById('inventarioContent').innerHTML = tableContent;
    configurarEventos();
}


function generarFilaConsulta() {
    return `
        <tr class="fila-consulta">
            <td>
                <input type="text" id="inputCodigo" placeholder="C√≥digo" list="listaCodigosTuberias" autocomplete="off">
                <datalist id="listaCodigosTuberias">
                    ${tuberiasDisponibles.map(item => 
                        `<option value="${item.codigo}" data-descripcion="${item.descripcion}">${item.descripcion}</option>`).join('')}
                </datalist>
            </td>
            <td>
                <input type="text" id="inputDescripcion" 
                    placeholder="Buscar tuber√≠a..." 
                    list="listaTuberias" autocomplete="off">
                <datalist id="listaTuberias">
                    ${tuberiasDisponibles.map(item => 
                        `<option value="${item.descripcion}" data-codigo="${item.codigo}">${item.codigo}</option>`).join('')}
                </datalist>
            </td>
            <td>
                <select id="inputUbicacion" class="form-select">
                    ${ubicacionesDisponibles.map(ubicacion => 
                        `<option value="${ubicacion}">${ubicacion}</option>`).join('')}
                </select>
            </td>
            <td id="cantidadCell">
                <input type="number" id="inputCantidad" placeholder="Cantidad" min="0" value="0" onchange="actualizarEstadoStock()" disabled>
            </td>
            <td>
                <input type="number" id="inputValor" placeholder="Valor" min="0" step="0.01" disabled>
            </td>
        </tr>
    `;
}


function actualizarEstadoStock() {
    const cantidadInput = document.getElementById('inputCantidad');
    const cantidadCell = document.getElementById('cantidadCell');
    const valor = parseFloat(cantidadInput.value) || 0;
    
    if (valor === 0) {
        cantidadCell.innerHTML = `
            <span class="no-stock" onclick="restaurarInputCantidad()">No Stock</span>
            <input type="number" id="inputCantidad" value="0" min="0" style="display:none;">
        `;
    } else {
        cantidadCell.innerHTML = `<input type="number" id="inputCantidad" placeholder="Cantidad" min="0" value="${valor}" onchange="actualizarEstadoStock()">`;
    }
    
    if (itemActual) {
        itemActual.cantidad = valor;
        actualizarGrafica();
    }
}

function restaurarInputCantidad() {
    const cantidadCell = document.getElementById('cantidadCell');
    cantidadCell.innerHTML = `<input type="number" id="inputCantidad" placeholder="Cantidad" min="0" value="0" onchange="actualizarEstadoStock()" disabled>`;
}

// Mejorar la conexi√≥n con el inventario global
function configurarEventos() {
  const inputCodigo = document.getElementById('inputCodigo');
  const inputDesc = document.getElementById('inputDescripcion');
  
  // Usar el inventario global como fuente de verdad
  inputCodigo.addEventListener('input', function() {
    const producto = InventarioCompartido.buscarProducto(this.value);
    if (producto) {
      inputDesc.value = producto.descripcion;
      document.getElementById('inputCantidad').value = producto.cantidad || 0;
      document.getElementById('inputValor').value = producto.valor || 0;
      document.getElementById('inputUbicacion').value = producto.ubicacion || 'Bogot√°';
      itemActual = {...producto};
      actualizarGrafica();
    }
  });
  
  inputDesc.addEventListener('input', function() {
    const producto = InventarioCompartido.buscarProducto(this.value);
    if (producto) {
      inputCodigo.value = producto.codigo;
      document.getElementById('inputCantidad').value = producto.cantidad || 0;
      document.getElementById('inputValor').value = producto.valor || 0;
      document.getElementById('inputUbicacion').value = producto.ubicacion || 'Bogot√°';
      itemActual = {...producto};
      actualizarGrafica();
    }
  });
  
  // Escuchar cambios en el inventario global
  window.addEventListener('inventarioActualizado', () => {
    if (itemActual) {
      const productoActualizado = InventarioCompartido.buscarProducto(itemActual.codigo);
      if (productoActualizado) {
        itemActual = {...productoActualizado};
        actualizarGrafica();
      }
    }
  });
}


function actualizarGrafica() {
    const chartContainer = document.querySelector('.chart-container');
    const chartElement = document.getElementById('tuberiaChart');
    
    if (!itemActual || itemActual.cantidad <= 0) {
        chartContainer.style.display = 'none';
        if (chart) {
            chart.destroy();
            chart = null;
        }
        return;
    }
    
    chartContainer.style.display = 'block';
    
    if (chart) {
        chart.destroy();
    }
    
    // Configurar dimensiones fijas para el canvas
    chartElement.width = chartElement.offsetWidth;
    chartElement.height = 250; // Altura fija
    
    chart = new Chart(chartElement, {
        type: 'bar',
        data: {
            labels: [itemActual.descripcion],
            datasets: [{
                label: 'Cantidad',
                data: [itemActual.cantidad],
                backgroundColor: 'rgba(54, 162, 235, 0.7)',
                borderColor: 'rgba(54, 162, 235, 1)',
                borderWidth: 1
            }]
        },
        options: {
            indexAxis: 'y',
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                x: { 
                    beginAtZero: true,
                    ticks: { precision: 0 }
                },
                y: { 
                    ticks: { 
                        autoSkip: false,
                        font: { size: 12 }
                    } 
                }
            },
            plugins: {
                legend: { display: false },
                tooltip: {
                    callbacks: {
                        afterLabel: () => {
                            return `C√≥digo: ${itemActual.codigo}\nValor: $${itemActual.valor.toFixed(2)}`;
                        }
                    }
                }
            }
        }
    });
}

function exportarAExcel() {
    if (!itemActual) {
        alert("No hay datos para exportar");
        return;
    }
    
    const cantidadInput = document.getElementById('inputCantidad');
    const cantidad = parseFloat(cantidadInput.value) || 0;
    
    const datos = [{
        'C√≥digo': itemActual.codigo,
        'Descripci√≥n': itemActual.descripcion,
        'Ubicaci√≥n': itemActual.ubicacion || 'Bogot√°',
        'Cantidad': cantidad === 0 ? 'No Stock' : cantidad,
        'Valor': itemActual.valor
    }];
    
    const csvRows = [];
    const headers = Object.keys(datos[0]);
    csvRows.push(headers.join(','));
    
    for (const row of datos) {
        const values = headers.map(header => {
            const escaped = ('' + row[header]).replace(/"/g, '\\"');
            return `"${escaped}"`;
        });
        csvRows.push(values.join(','));
    }
    
    const csvString = csvRows.join('\n');
    const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    
    const link = document.createElement('a');
    link.setAttribute('href', url);
    link.setAttribute('download', `tuberia_${itemActual.codigo}.csv`);
    link.style.visibility = 'hidden';
    
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
}

// ================================================================================
// INVENTARIO ACCESORIOS
// ================================================================================

const accesoriosData = {
    "Cobre": {
        "Union": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2", "2.1/2", "3"],
        "Tee": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2", "2.1/2", "3", "Reducida"],
        "Tee Reducida": ["1*3/4", "1*1/2", "3/4*1/2", "1/2*3/8", "1/2*1", "1.1/4*3/4"],
        "Codo": ["1/8", "1/4", "3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2", "2.1/2", "3"],
        "Semicodo": ["1/2", "3/4", "1", "1.1/4", "1.1/2", "2", "3"],
        "CopaRed": ["3*2.1/2", "3*2", "2*1.1/2", "2*1.1/4", "2*1", "1*3/4", "1*3/8", "1*1/2", "3/4*1/2", "3/4*3/8", "3/4*1/4", "1/2*3/8", "1/2*1/4", "1/2*1/8"],
        "Universales": ["3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2", "2.1/2", "3"],
        "Tapon": ["1/8", "1/4", "3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2", "2.1/2", "3"],
        "Adaptador": {
            "Soldeo": {
                "NPTH": ["3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTM": ["3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"]
            }
        }
    },
    "Acero Inoxidable": {
        "Conector": {
            "OD": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "NPTM": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "NPTH": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "OD/NPTM": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            },
            "OD/NPTH": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            },
            "NPTM/NPTH": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            }
        },
        "Tee": {
            "OD": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "Sch40": {
                "SoldeoTope": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            }
        },
        "Codo": {
            "OD": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTM": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTH": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "OD/NPTM": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            },
            "OD/NPTH": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            },
            "NPTM/NPTH": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            },
            "Sch40": {
                "SoldeoTope": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            }
        },
        "Niple": {
            "Sch40": {
                "SoldeoTope": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
                "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            }
        },
        "Universal": ["1/2", "3/4", "1", "1.1/4", "1.1/2"],
        "Tapon": {
            "Sch40": ["1/4", "3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "NPTH": ["1/4", "3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "NPTM": ["1/4", "3/8", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"]
        },
        "Bushing": {
            "Sch40": {
                "1/4": ["3/8", "1/2", "1"],
                "1/2": ["1", "1.1/2", "2"],
                "3/8": ["1/2", "1"],
                "3/4": ["1", "1.1/4", "1.1/2", "2"],
                "1": ["1/4", "1/2", "2"],
                "1.1/4": ["1.1/2", "2"],
                "1.1/2": ["2"]
            }
        },
        "CopaRed": {
            "Sch40": {
                "1/4": ["1/2", "3/4"],
                "1/2": ["3/4", "1", "1.1/2"],
                "3/4": ["1", "1.1/2", "2"],
                "1": ["1.1/2"],
                "1.1/2": ["2"]
            }
        },
        "Brida": {
            "Sch40": {
                "SoldeoTope": ["1/2", "3/4", "1", "1.1/2", "2"]
            }
        },
        "Valvula": {
            "4Tornillos": ["1/4", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "deBola": ["1/4", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "TipoL": {
                "OD": ["1/4"],
                "OD/NPTM": ["1/4*1/4"],
                "NPTH": ["1/4"],
                "DosVias": ["1/4 OD"],
                "Recta": ["1/4 NPTH"]
            }
        }
    },

    "Bronce": {
        "Niple": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
        "Conector": {
            "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "OD/NPTM": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1/2": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            },
            "OD/NPTH": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            },
            "NPTM/NPTH": {
                "1/8": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/4": ["1/4", "1/2", "3/4", "3/8", "1"],
                "1/2": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/8": ["1/4", "1/2", "3/4", "3/8", "1", "1.1/2"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/2"],
                "1.1/4": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "1.1/2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"],
                "2": ["1/2", "3/4", "3/8", "1", "1.1/2", "2"]
            }
        },
        "Racore": {
            "NPTM/DISS": {
                "1/2": ["aire", "oxigeno", "vacio", "nitrogeno"],
                "3/4": ["aire", "oxigeno", "vacio", "nitrogeno"]
            },
            "RoscaSoldeo": ["1/2", "3/4", "1", "1.1/4", "1.1/2"]
        },
        "Tapon": {
            "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"]
        },
        "Bushing": {
            "1/4": ["3/8", "1/2", "1"],
            "1/2": ["1", "1.1/2", "2"],
            "3/8": ["1/2", "1"],
            "3/4": ["1", "1.1/4", "1.1/2", "2"],
            "1": ["1/4", "1/2", "2"],
            "1.1/4": ["1.1/2", "2"],
            "1.1/2": ["2"]
        },
        "Valvula": {
            "4Tornillos": ["1/4", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "deBola": ["1/4", "1/2", "3/4", "1", "1.1/4", "1.1/2", "2"],
            "4Vias": ["1/8 NPTH"]
        },
        "Codo": {
            "OD": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTM": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTH": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "OD/NPTM": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            },
            "OD/NPTH": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            },
            "NPTM/NPTH": {
                "1/8": ["1/8", "1/4", "1/2"],
                "1/4": ["1/4", "1/8", "1/2", "3/8", "3/4", "1"],
                "1/2": ["1/8", "1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/8": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "3/4": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4"],
                "1": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2", "2"]
            }
        },
        "Tee": {
            "OD": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTM": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"],
            "NPTH": ["1/4", "1/2", "3/8", "3/4", "1", "1.1/4", "1.1/2"]
        }
    },
    "Acero Carbon": {
        // Similar a Acero Inoxidable pero con menos variedad
        "Tee": {
            "Sch40": {
                "SoldeoTope": ["1/2", "3/4", "1", "1.1/2", "2"],
                "NPTM": ["1/2", "3/4", "1", "1.1/2", "2"],
                "NPTH": ["1/2", "3/4", "1", "1.1/2", "2"]
            }
        },
        "Codo": {
            "Sch40": {
                "SoldeoTope": ["1/2", "3/4", "1", "1.1/2", "2"],
                "NPTM": ["1/2", "3/4", "1", "1.1/2", "2"],
                "NPTH": ["1/2", "3/4", "1", "1.1/2", "2"]
            }
        },
        "Brida": {
            "Sch40": {
                "SoldeoTope": ["1/2", "3/4", "1", "1.1/2", "2"]
            }
        },
        "Bushing": {
            "Sch40": {
                "1/2": ["1", "1.1/2", "2"],
                "3/4": ["1", "1.1/2", "2"],
                "1": ["1.1/2", "2"],
                "1.1/2": ["2"]
            }
        }
    }
};






        // Generar mapeo de descripciones a c√≥digos para accesorios
const descripcionToCodigoAccesorios = {};
const descripcionesDisponiblesAccesorios = [];
let codigoCounterAccesorios = 95; // Comenzar desde IYR0095

// Funci√≥n para generar c√≥digos basados en la estructura de datos
function generarCodigosAccesorios(material, tipo, detalles, prefijo = '') {
    const materialKey = material.replace(/\s+/g, '');
    
    if (Array.isArray(detalles)) {
        // Para elementos simples como di√°metros
        detalles.forEach(diametro => {
            const descripcion = `${tipo}${materialKey}${prefijo}${diametro}`;
            const codigo = "IYR" + codigoCounterAccesorios.toString().padStart(4, '0');
            
            descripcionToCodigoAccesorios[descripcion] = codigo;
            descripcionesDisponiblesAccesorios.push(descripcion);
            codigoCounterAccesorios++;
        });
    } else if (typeof detalles === 'object') {
        // Para estructuras anidadas
        for (const [subtipo, subdetalles] of Object.entries(detalles)) {
            generarCodigosAccesorios(
                material, 
                tipo, 
                subdetalles, 
                `${prefijo}${prefijo ? ' ' : ''}${subtipo} `
            );
        }
    }
}

// Generar todos los c√≥digos para cada material
for (const [material, tipos] of Object.entries(accesoriosData)) {
    for (const [tipo, detalles] of Object.entries(tipos)) {
        generarCodigosAccesorios(material, tipo, detalles);
    }
}

// Variables para accesorios
let itemActualAccesorio = null;
let chartAccesorios;

// Funciones para accesorios
function loadAccesorios() {
    const productosAccesorios = InventarioCompartido.obtenerProductos()
        .filter(p => !p.descripcion.includes('Tuber√≠a'));
    // Actualizar pesta√±a activa
    document.getElementById('accesoriosTab').classList.add('active');
    document.getElementById('tuberiaTab').classList.remove('active');
    
    const tableContent = `
        <div class="table-title-container">
            <div class="section-title vertical-title">Accesorios</div>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th>C√≥digo</th>
                            <th>Descripci√≥n</th>
                            <th>Ubicaci√≥n</th>
                            <th>Cantidad</th>
                            <th>Valor</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${generarFilaConsultaAccesorios()}
                    </tbody>
                </table>
                <div class="export-button-container">
                    <button id="btnExportarAccesorios">Exportar a Excel</button>
                </div>
            </div>
        </div>
        <div class="chart-container">
            <h3>Gr√°fica de Consulta</h3>
            <canvas id="accesoriosChart"></canvas>
        </div>
    `;

    document.getElementById('inventarioContent').innerHTML = tableContent;
    document.getElementById('inventarioContent').classList.add('content-transition');
    
    // Configurar eventos
    configurarEventosAccesorios();
    
    // Mostrar gr√°fica (aunque vac√≠a)
    document.getElementById('accesoriosChart').style.display = 'block';
}


function generarFilaConsultaAccesorios() {
    return `
        <tr class="fila-consulta">
            <td>
                <input type="text" id="inputCodigoAccesorio" placeholder="C√≥digo" list="listaCodigosAccesorios" autocomplete="off">
                <datalist id="listaCodigosAccesorios">
                    ${descripcionesDisponiblesAccesorios.map(desc => 
                        `<option value="${descripcionToCodigoAccesorios[desc]}" data-descripcion="${desc}">${desc}</option>`).join('')}
                </datalist>
            </td>
            <td>
                <input type="text" id="inputDescripcionAccesorio" 
                    placeholder="Buscar accesorio..." 
                    list="listaAccesorios" autocomplete="off">
                <datalist id="listaAccesorios">
                    ${descripcionesDisponiblesAccesorios.map(desc => 
                        `<option value="${desc}" data-codigo="${descripcionToCodigoAccesorios[desc]}">${descripcionToCodigoAccesorios[desc]}</option>`).join('')}
                </datalist>
            </td>
            <td>
                <select id="inputUbicacionAccesorio" class="form-select">
                    ${ubicacionesDisponibles.map(ubicacion => 
                        `<option value="${ubicacion}">${ubicacion}</option>`).join('')}
                </select>
            </td>
            <td id="cantidadCellAccesorio" style="width: 120px;">
                <div class="cantidad-container">
                    <input type="number" id="inputCantidadAccesorio" placeholder="Cantidad" min="0" value="0" onchange="actualizarEstadoStockAccesorios()" disabled>
                </div>
            </td>
            <td>
                <input type="number" id="inputValorAccesorio" placeholder="Valor" min="0" step="0.01" disabled>
            </td>
        </tr>
    `;
}

function actualizarEstadoStockAccesorios() {
    const cantidadInput = document.getElementById('inputCantidadAccesorio');
    const cantidadCell = document.getElementById('cantidadCellAccesorio');
    const valor = parseFloat(cantidadInput.value) || 0;
    
    if (valor === 0) {
        cantidadCell.innerHTML = `
            <div class="cantidad-container">
                <span class="no-stock" onclick="restaurarInputCantidadAccesorios()">No Stock</span>
                <input type="number" id="inputCantidadAccesorio" value="0" min="0" style="display:none;">
            </div>
        `;
    } else {
        cantidadCell.innerHTML = `
            <div class="cantidad-container">
                <input type="number" id="inputCantidadAccesorio" placeholder="Cantidad" min="0" value="${valor}" onchange="actualizarEstadoStockAccesorios()">
            </div>
        `;
    }
    
    if (itemActualAccesorio) {
        itemActualAccesorio.cantidad = valor;
        actualizarGraficaAccesorios();
    }
}

function restaurarInputCantidadAccesorios() {
    const cantidadCell = document.getElementById('cantidadCellAccesorio');
    cantidadCell.innerHTML = `<input type="number" id="inputCantidadAccesorio" placeholder="Cantidad" min="0" value="0" onchange="actualizarEstadoStockAccesorios()" disabled>`;
}

function configurarEventosAccesorios() {
    const inputCodigo = document.getElementById('inputCodigoAccesorio');
    const inputDesc = document.getElementById('inputDescripcionAccesorio');
    
    // Evento para cuando se escribe en el campo de c√≥digo
    inputCodigo.addEventListener('input', function() {
        const codigo = this.value;
        const selectedOption = document.querySelector(`#listaCodigosAccesorios option[value="${codigo}"]`);
        const descripcion = selectedOption ? selectedOption.getAttribute('data-descripcion') : '';
        
        if (descripcion) {
            document.getElementById('inputDescripcionAccesorio').value = descripcion;
            itemActualAccesorio = {
                codigo: codigo,
                descripcion: descripcion,
                ubicacion: document.getElementById('inputUbicacionAccesorio').value || 'Bogot√°',
                cantidad: 0,
                valor: parseFloat(document.getElementById('inputValorAccesorio').value) || 0
            };
            
            actualizarGraficaAccesorios();
        } else {
            document.getElementById('inputDescripcionAccesorio').value = '';
            if (chartAccesorios) {
                chartAccesorios.destroy();
                chartAccesorios = null;
            }
        }
    });
    
    // Evento para cuando se escribe en el campo de descripci√≥n
    inputDesc.addEventListener('input', function() {
        const descripcion = this.value;
        const codigo = descripcionToCodigoAccesorios[descripcion];
        
        document.getElementById('inputCodigoAccesorio').value = codigo || '';
        
        if (codigo) {
            itemActualAccesorio = {
                codigo: codigo,
                descripcion: descripcion,
                ubicacion: document.getElementById('inputUbicacionAccesorio').value || 'Bogot√°',
                cantidad: 0,
                valor: parseFloat(document.getElementById('inputValorAccesorio').value) || 0
            };
            
            actualizarGraficaAccesorios();
        } else {
            if (chartAccesorios) {
                chartAccesorios.destroy();
                chartAccesorios = null;
            }
        }
    });

    ['inputUbicacionAccesorio', 'inputValorAccesorio'].forEach(id => {
        document.getElementById(id).addEventListener('change', function() {
            if (itemActualAccesorio) {
                itemActualAccesorio.ubicacion = document.getElementById('inputUbicacionAccesorio').value;
                itemActualAccesorio.valor = parseFloat(document.getElementById('inputValorAccesorio').value) || 0;
                actualizarGraficaAccesorios();
            }
        });
    });
    
    document.getElementById('btnExportarAccesorios').addEventListener('click', exportarAExcelAccesorios);
    actualizarEstadoStockAccesorios();
}

        function actualizarGraficaAccesorios() {
            if (!itemActualAccesorio) {
                document.getElementById('accesoriosChart').style.display = 'none';
                return;
            }
            
            const ctx = document.getElementById('accesoriosChart').getContext('2d');
            ctx.canvas.style.display = 'block';
            ctx.canvas.width = ctx.canvas.offsetWidth;
            ctx.canvas.height = 300;
            
            if (chartAccesorios) {
                chartAccesorios.destroy();
            }
            
            chartAccesorios = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: [itemActualAccesorio.descripcion],
                    datasets: [{
                        label: 'Cantidad',
                        data: [itemActualAccesorio.cantidad],
                        backgroundColor: 'rgba(255, 99, 132, 0.7)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y',
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: { 
                            beginAtZero: true,
                            ticks: { precision: 0 }
                        },
                        y: { 
                            ticks: { 
                                autoSkip: false,
                                font: { size: 12 }
                            } 
                        }
                    },
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                afterLabel: () => {
                                    return `C√≥digo: ${itemActualAccesorio.codigo}\nValor: $${itemActualAccesorio.valor.toFixed(2)}`;
                                }
                            }
                        }
                    },
                    layout: {
                        padding: {
                            top: 10,
                            right: 10,
                            bottom: 10,
                            left: 10
                        }
                    }
                }
            });
        }

        function exportarAExcelAccesorios() {
            if (!itemActualAccesorio) {
                alert("No hay datos para exportar");
                return;
            }
            
            const cantidadInput = document.getElementById('inputCantidadAccesorio');
            const cantidad = parseFloat(cantidadInput.value) || 0;
            
            const datos = [{
                'C√≥digo': itemActualAccesorio.codigo,
                'Descripci√≥n': itemActualAccesorio.descripcion,
                'Ubicaci√≥n': itemActualAccesorio.ubicacion || 'Bogot√°',
                'Cantidad': cantidad === 0 ? 'No Stock' : cantidad,
                'Valor': itemActualAccesorio.valor
            }];
            
            const csvRows = [];
            const headers = Object.keys(datos[0]);
            csvRows.push(headers.join(','));
            
            for (const row of datos) {
                const values = headers.map(header => {
                    const escaped = ('' + row[header]).replace(/"/g, '\\"');
                    return `"${escaped}"`;
                });
                csvRows.push(values.join(','));
            }
            
            const csvString = csvRows.join('\n');
            const blob = new Blob([csvString], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.setAttribute('href', url);
            link.setAttribute('download', `accesorio_${itemActualAccesorio.codigo}.csv`);
            link.style.visibility = 'hidden';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // MODULO COMPARTIDO DE ALMACEN Y INVENTARIO
        window.InventarioCompartido = {
            productos: [],
            
            init: function() {
                const datosGuardados = localStorage.getItem('inventarioCompartido');
                if (datosGuardados) {
                    this.productos = JSON.parse(datosGuardados);
                } else {
                    this.inicializarDatosPorDefecto();
                }
                
                // Escuchar eventos de actualizaci√≥n
                window.addEventListener('inventarioActualizado', () => {
                    this.actualizarDesdeLocalStorage();
                    if (document.getElementById('inventarioContent')) {
                        // Recargar la vista actual
                        if (document.getElementById('tuberiaTab').classList.contains('active')) {
                            loadTuberia();
                        } else {
                            loadAccesorios();
                        }
                    }
                });
            },

            actualizarDesdeLocalStorage: function() {
                const datosGuardados = localStorage.getItem('inventarioCompartido');
                if (datosGuardados) {
                    this.productos = JSON.parse(datosGuardados);
                }
            },
            
            inicializarDatosPorDefecto: function() {
                // Tuber√≠as (todos los c√≥digos que proporcionaste)
                const tuberias = [
            ];
                 
                // Accesorios (generados din√°micamente)
                const accesorios = [];
                let codigoCounter = 95; // IYR0095 en adelante
                
                // Generar accesorios basados en la estructura de datos
                for (const [material, tipos] of Object.entries(accesoriosData)) {
                    for (const [tipo, detalles] of Object.entries(tipos)) {
                        const nuevosAccesorios = this.generarAccesorios(material, tipo, detalles, codigoCounter);
                        accesorios.push(...nuevosAccesorios);
                        codigoCounter += nuevosAccesorios.length;
                    }
                }
                
                this.productos = [...tuberias, ...accesorios];
                this.guardarDatos();
            },
            
            generarAccesorios: function(material, tipo, detalles, startCodigo, prefijo = '') {
                const accesorios = [];
                let codigoCounter = startCodigo;
                
                if (Array.isArray(detalles)) {
                    // Para elementos simples como di√°metros
                    detalles.forEach(diametro => {
                        accesorios.push({
                            codigo: "IYR" + codigoCounter.toString().padStart(4, '0'),
                            descripcion: `${tipo}${material.replace(/\s+/g, '')}${prefijo}${diametro}`,
                            cantidad: 0,
                            valor: 0
                        });
                        codigoCounter++;
                    });
                } else if (typeof detalles === 'object') {
                    // Para estructuras anidadas
                    for (const [subtipo, subdetalles] of Object.entries(detalles)) {
                        const nuevos = this.generarAccesorios(
                            material, 
                            tipo, 
                            subdetalles, 
                            codigoCounter,
                            `${prefijo}${prefijo ? ' ' : ''}${subtipo} `
                        );
                        accesorios.push(...nuevos);
                        codigoCounter += nuevos.length;
                    }
                }
                
                return accesorios;
            },
            
            buscarProducto: function(codigo) {
                return this.productos.find(p => p.codigo === codigo);
            },
            
            actualizarProducto: function(codigo, cantidad, valor, ubicacion) {
                const producto = this.buscarProducto(codigo);
                if (producto) {
                    producto.cantidad = (producto.cantidad || 0) + cantidad;
                    if (valor) producto.valor = valor;
                    if (ubicacion) producto.ubicacion = ubicacion;
                    this.guardarDatos();
                    return true;
                }
                return false;
            },
            
            guardarDatos: function() {
                localStorage.setItem('inventarioCompartido', JSON.stringify(this.productos));
            },
            
            obtenerProductos: function() {
                return this.productos;
            }
        };

                

        // Inicializaci√≥n robusta al cargar la p√°gina
        document.addEventListener('DOMContentLoaded', function() {
            // 1. Inicializa el m√≥dulo compartido PRIMERO.
            // Esto asegura que la lista de productos (InventarioCompartido.productos)
            // se cargue desde localStorage o se cree con los datos por defecto si no existe.
            InventarioCompartido.init();

            // 2. Luego, inicializa el m√≥dulo espec√≠fico de la p√°gina (Almac√©n).
            // Ahora AlmacenModule puede confiar en que InventarioCompartido est√° listo y 
            // tiene todos los productos cargados en memoria.
            AlmacenModule.init();
        });

        
    </script>
</body>
</html>